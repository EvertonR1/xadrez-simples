<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Xadrez Simples</title>
<style>
body { display:flex; justify-content:center; align-items:center; height:100vh; background:#f0d9b5; }
#tab { display:grid; grid-template-columns: repeat(8,60px); grid-template-rows:repeat(8,60px); border:3px solid black; }
.casa { width:60px; height:60px; display:flex; justify-content:center; align-items:center; font-size:36px; cursor:pointer; user-select:none; }
.clara { background:#eeeed2; }
.escura { background:#769656; }
.sel { outline:3px solid yellow; }
.pos { outline:3px solid cyan; }
</style>
</head>
<body>
<div id="tab"></div>
<script>
let pecas = {'r':'♜','n':'♞','b':'♝','q':'♛','k':'♚','p':'♟','R':'♖','N':'♘','B':'♗','Q':'♕','K':'♔','P':'♙'};
let tabuleiro = [
['r','n','b','q','k','b','n','r'],
['p','p','p','p','p','p','p','p'],
['','','','','','','',''],
['','','','','','','',''],
['','','','','','','',''],
['','','','','','','',''],
['P','P','P','P','P','P','P','P'],
['R','N','B','Q','K','B','N','R']
];
let sel = null;
let vez = 'brancas';
let tab = document.getElementById('tab');

function mostrar(){
 tab.innerHTML='';
 for(let i=0;i<8;i++){
   for(let j=0;j<8;j++){
     let c = document.createElement('div');
     c.classList.add('casa');
     if((i+j)%2==0)c.classList.add('clara'); else c.classList.add('escura');
     if(sel && sel[0]==i && sel[1]==j)c.classList.add('sel');
     c.innerHTML = pecas[tabuleiro[i][j]]||'';
     c.dataset.i=i; c.dataset.j=j;
     c.addEventListener('click',clicar);
     tab.appendChild(c);
   }
 }
}

function movValido(orig,dest){
 let li=orig[0],ci=orig[1],lf=dest[0],cf=dest[1];
 let p=tabuleiro[li][ci],a=tabuleiro[lf][cf];
 if(!p) return false;
 if((vez=='brancas' && p==p.toLowerCase()) || (vez=='pretas' && p==p.toUpperCase())) return false;
 if(a!=='' && ((p==p.toUpperCase() && a==a.toUpperCase()) || (p==p.toLowerCase() && a==a.toLowerCase()))) return false;
 let dx=cf-ci, dy=lf-li;
 switch(p.toLowerCase()){
   case 'p': let dir=(p=='P')?-1:1;
     if(dx==0 && dy==dir && a=='') return true;
     if(dx==0 && dy==2*dir && ((p=='P' && li==6)||(p=='p' && li==1)) && tabuleiro[li+dir][ci]==='' && a=='') return true;
     if(Math.abs(dx)==1 && dy==dir && a!='') return true;
     return false;
   case 'r': if(dx==0||dy==0) return caminho(li,ci,lf,cf); return false;
   case 'b': if(Math.abs(dx)==Math.abs(dy)) return caminho(li,ci,lf,cf); return false;
   case 'q': if(dx==0||dy==0||Math.abs(dx)==Math.abs(dy)) return caminho(li,ci,lf,cf); return false;
   case 'k': return Math.abs(dx)<=1 && Math.abs(dy)<=1;
   case 'n': return (Math.abs(dx)==2 && Math.abs(dy)==1)||(Math.abs(dx)==1 && Math.abs(dy)==2);
 }
 return false;
}

function caminho(li,ci,lf,cf){
 let passoX=Math.sign(cf-ci), passoY=Math.sign(lf-li), x=ci+passoX, y=li+passoY;
 while(x!=cf || y!=lf){
   if(tabuleiro[y][x]!='') return false;
   x+=passoX; y+=passoY;
 }
 return true;
}

function mostrarPossiveis(){
 if(!sel) return;
 for(let i=0;i<8;i++){
   for(let j=0;j<8;j++){
     if(movValido(sel,[i,j])){
       let idx=i*8+j;
       tab.children[idx].classList.add('pos');
     }
   }
 }
}

function clicar(e){
 let i=parseInt(e.currentTarget.dataset.i);
 let j=parseInt(e.currentTarget.dataset.j);
 if(sel){
   if(movValido(sel,[i,j])){
     let destino = tabuleiro[i][j];
     tabuleiro[i][j]=tabuleiro[sel[0]][sel[1]];
     tabuleiro[sel[0]][sel[1]]='';
     if(destino.toLowerCase()=='k'){alert(vez+' ganhou!'); location.reload();}
     vez=(vez=='brancas')?'pretas':'brancas';
   }
   sel=null;
   mostrar();
 } else{
   if(tabuleiro[i][j]!='') sel=[i,j];
   mostrar();
 }
}

document.addEventListener('keydown',e=>{
 if(e.key.toLowerCase()=='a'){ mostrar(); mostrarPossiveis();}
});

mostrar();
</script>
</body>
</html>
